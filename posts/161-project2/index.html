<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CS161 Project 2 | EJam's Space</title>
<meta name=keywords content="go,Berkeley,project,school,security,design"><meta name=description content="I was super into this project and ended up getting full credit! It&rsquo;s 12 am and I can&rsquo;t sleep, so I thought I&rsquo;ll try to reflect on this project a bit, both for myself but also maybe it will help someone. And I may just be trying brag a bit so if any recruiter sees this, please hire me.
Basically, 161 is the Berkeley computer security and my favorite class so far."><meta name=author content><link rel=canonical href=https://ejammy.github.io/posts/161-project2/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://ejammy.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ejammy.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ejammy.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ejammy.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ejammy.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ejammy.github.io/posts/161-project2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script data-goatcounter=https://ejammy.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script async data-id=101407716 src=//static.getclicky.com/js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TBJXCCN715"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TBJXCCN715",{anonymize_ip:!1})}</script><meta property="og:title" content="CS161 Project 2"><meta property="og:description" content="I was super into this project and ended up getting full credit! It&rsquo;s 12 am and I can&rsquo;t sleep, so I thought I&rsquo;ll try to reflect on this project a bit, both for myself but also maybe it will help someone. And I may just be trying brag a bit so if any recruiter sees this, please hire me.
Basically, 161 is the Berkeley computer security and my favorite class so far."><meta property="og:type" content="article"><meta property="og:url" content="https://ejammy.github.io/posts/161-project2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-14T09:56:44-07:00"><meta property="article:modified_time" content="2024-03-14T09:56:44-07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="CS161 Project 2"><meta name=twitter:description content="I was super into this project and ended up getting full credit! It&rsquo;s 12 am and I can&rsquo;t sleep, so I thought I&rsquo;ll try to reflect on this project a bit, both for myself but also maybe it will help someone. And I may just be trying brag a bit so if any recruiter sees this, please hire me.
Basically, 161 is the Berkeley computer security and my favorite class so far."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ejammy.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CS161 Project 2","item":"https://ejammy.github.io/posts/161-project2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CS161 Project 2","name":"CS161 Project 2","description":"I was super into this project and ended up getting full credit! It\u0026rsquo;s 12 am and I can\u0026rsquo;t sleep, so I thought I\u0026rsquo;ll try to reflect on this project a bit, both for myself but also maybe it will help someone. And I may just be trying brag a bit so if any recruiter sees this, please hire me.\nBasically, 161 is the Berkeley computer security and my favorite class so far.","keywords":["go","Berkeley","project","school","security","design"],"articleBody":"I was super into this project and ended up getting full credit! It’s 12 am and I can’t sleep, so I thought I’ll try to reflect on this project a bit, both for myself but also maybe it will help someone. And I may just be trying brag a bit so if any recruiter sees this, please hire me.\nBasically, 161 is the Berkeley computer security and my favorite class so far. In the second project, you build a “secure file storage system.” It’s probably one of the most open-ended project. After the deadline, the autograder will test your solution for weakness. As such, this is not one of the project where most people get full credit or close to full credit. The distribution looks more like this.\nA lot of times I get to around 90% for my projects (you usually have an idea of what you would get in other projects), and just call it a day. I guess because of the challenge in this one and the bragging right potential I ended up spending way more time.\nDesigning Not going to lie, I already had high hopes when starting this project. I mean, just encrypt with AES and share keys with RSA, how hard could that be? Turns out the design was not as easy as I thought.\nI don’t want to give away too much, but one really big observation that we missed when designing limits how you can find the location of files. Basically, there are two important requirements: 1. users will run multiple copies of the program and 2. append must be constant time. The obvious way to retrieve a file, storing a map of filename to UUID, will most likely break one of the two requirements. We spend a lot of time trying to come up with a solution, but it’s actually right in the skeleton code. Read the skeleton code!\nThe other hard part in my opinion is sharing. For this I don’t really have much to say, other than just try some different ideas.\nOverall, it’s a good idea to try to seek simple design. I don’t want to say it’s trivial for this project, but try different ideas before your design gets super complicated.\nCoding Helper functions!!\nBreak down your design. Some people had 2k lines. We had 700, and our code isn’t even that clean. I think structuring code is a very valuable skill from this class. You don’t want to spend all the time refactoring, but definitely try a little bit to make it cleaner. To be fair, it’s actually not that easy. On one hand you want to have well-defined helper functions instead of fuzzy ones, so you actually know what to do, and it’s much easier to collaborate. On the other hand, you might realize there’s a case where you want to use a function, but it does something slightly different and your function is not general enough. Personally, I sometimes try too hard to design my code to make it more “aesthetic”, like remove one edge case, pass one less parameter, keep my code extra DRY. I think at some point it becomes not worth it, especially for short-lived projects like this.\nBut either way, a subpar structure still helps tremendously compared to no structure / a long block of code.\nThis also goes back to designing. For example, you can define something simple like functions to interact with the datastore with security and integrity, and suddenly everything is easier. The dream is to have the code read like the design doc.\nDebugging Note to self: take breaks when coding. Literally wasted like 4 hours because I didn’t call json.Marshal or something.\nPrintf debugging is good. Debugger is also pretty good.\nTesting Ok this is (in my opinion) the fun part. You get to break your design.\nI had this really fun idea (something similar is also suggested in the tips from the spec) to bascially:\nSetup the system to some state Poke at a random byte Run some more functions, which should either yield the correct result, or error Website TODO: add folding functionality for this chunck of code. Change tab size.\nfunc TestLargeModifyAttack(t *testing.T) { // run a bunch of client function m := userlib.DatastoreGetMap() orig := getDatastoreCopy() check := func(t *testing.T) { // run a bunch of client function and check that it either errors or is correct // ... } cnt := 0 for id, bytes := range orig { cnt += 1 for i, val := range bytes { doRun := i \u003c 400 \u0026\u0026 (i%100 == 0 || i%72 == 0) doRun = doRun || i \u003c 2 doRun = doRun || len(bytes)-i \u003c 2 if doRun { userlib.DatastoreClear() applyMap(orig) m[id][i] = val ^ 0xff testStr := \"poking byte at \" + id.String() + \" \" + strconv.Itoa(i) t.Run(testStr, check) } } } for id := range orig { for id2 := range orig { userlib.DatastoreClear() applyMap(orig) m[id], m[id2] = m[id2], m[id] testStr := \"swapping uuid at \" + id.String() + \"____\" + id2.String() t.Run(testStr, check) m[id], m[id2] = m[id2], m[id] } } } I used the go built-in testing framework instead of Ginkgo (the framework we were supposed to use), so my partner had to write some more tests in Ginkgo. And this is actually not that easy. The problem with complicated tests is that I ended up with not so obvious bugs in my test, and I don’t know if the bug is in my test or in my code. Would not recommend, unless you do it for fun. Not this way specifically at least, maybe something simpler that does the same thing.\nSwapping caught a bunch of key reuse problems. Then I had a pretty genius idea where I changed my secure_store_to_datastore function and never had to worry about key reuse ever again.\nA nasty attack func TestUserAttacks(t *testing.T) { // Incorrect password attack: // Replaces user in datastore with fake user, then, if user // forgets to enter password, they would succesfully log in // as the fake user. // // Fix: [redacted] // Generate a fake user t.Run(\"Incorrect password attack\", func(t *testing.T) { t.Logf(\"Generating fake user\") clear() client.InitUser(\"alice\", \"\") m := getDatastoreCopy() clear() t.Logf(\"Starting normal execution\") client.InitUser(\"alice\", \"realpassword\") // replace real user with fake user applyMap(m) for key, val := range m { t.Logf(\"%s, \", key) userlib.DatastoreSet(key, val) } _, err := client.GetUser(\"alice\", \"realpassword\") t.Logf(\"realpassword; error is %s\", err) _, err = client.GetUser(\"alice\", \"wrongpassword\") t.Logf(\"wrongpassword; error is %s\", err) _, err = client.GetUser(\"alice\", \"\") if err == nil { t.Errorf(\"failed fake password test\") } }) } Honestly, I don’t even know if this is valid or tested.\nFinal thoughts While the exact setup is not really something that would exist in the real world, it was still a nice project. I spend way more time on it than other projects.\nI think an important takeaway from this project is learning to design a whole code base. Projects in other classes, like 186, gives you very good skeleton code. This is great for learning the important algorithms and great ideas without requiring too much work. But being able to build (almost) from scratch is fun and valuable too.\nI love Go. It was fun to work in. Not too much crazy stuff going on, but also not annoying to work with.\nI wanted to write this up a while ago, but waited half a year after the project. It ended up to be a pretty fun write. I should probably go to bed now though.\n","wordCount":"1260","inLanguage":"en","datePublished":"2024-03-14T09:56:44-07:00","dateModified":"2024-03-14T09:56:44-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ejammy.github.io/posts/161-project2/"},"publisher":{"@type":"Organization","name":"EJam's Space","logo":{"@type":"ImageObject","url":"https://ejammy.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ejammy.github.io/ accesskey=h title="EJam's Space (Alt + H)">EJam's Space</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ejammy.github.io/posts title=Posts><span>Posts</span></a></li><li><a href=https://ejammy.github.io/past-work title="Past Work"><span>Past Work</span></a></li><li><a href=https://ejammy.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ejammy.github.io/playground title=Playground><span>Playground</span></a></li><li><a href=https://ejammy.github.io/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">CS161 Project 2</h1><div class=post-meta><span title='2024-03-14 09:56:44 -0700 -0700'>March 14, 2024</span></div></header><div class=post-content><p>I was super into this project and ended up getting full credit! It&rsquo;s 12 am and I can&rsquo;t sleep, so I thought I&rsquo;ll try to reflect on this project a bit, both for myself but also maybe it will help someone. And I may just be trying brag a bit <del>so if any recruiter sees this, please hire me</del>.</p><p>Basically, 161 is the Berkeley computer security and my favorite class so far. In the <a href=https://fa23.cs161.org/proj2>second project</a>, you build a &ldquo;secure file storage system.&rdquo; It&rsquo;s probably one of the most open-ended project. After the deadline, the autograder will test your solution for weakness. As such, this is not one of the project where most people get full credit or close to full credit. The distribution looks more like <a href=https://assets.cs161.org/proj2/proj2-spec-sp23-distribution.png>this</a>.</p><p>A lot of times I get to around 90% for my projects (you usually have an idea of what you would get in other projects), and just call it a day. I guess because of the challenge in this one and the bragging right potential I ended up spending way more time.</p><h2 id=designing>Designing<a hidden class=anchor aria-hidden=true href=#designing>#</a></h2><p>Not going to lie, I already had high hopes when starting this project. I mean, just encrypt with AES and share keys with RSA, how hard could that be? Turns out the design was not as easy as I thought.</p><p>I don&rsquo;t want to give away too much, but one really big observation that we missed when designing limits how you can find the location of files. Basically, there are two important requirements: 1. users will run multiple copies of the program and 2. append must be constant time. The obvious way to retrieve a file, storing a map of filename to UUID, will most likely break one of the two requirements. We spend a lot of time trying to come up with a solution, but it&rsquo;s actually <strong>right in the skeleton code</strong>. <strong>Read the skeleton code!</strong></p><p>The other hard part in my opinion is sharing. For this I don&rsquo;t really have much to say, other than just try some different ideas.</p><p>Overall, it&rsquo;s a good idea to try to seek simple design. I don&rsquo;t want to say it&rsquo;s trivial for this project, but try different ideas before your design gets super complicated.</p><h2 id=coding>Coding<a hidden class=anchor aria-hidden=true href=#coding>#</a></h2><p><strong>Helper functions!!</strong></p><p>Break down your design. Some people had 2k lines. We had 700, and our code isn&rsquo;t even that clean. I think structuring code is a very valuable skill from this class. You don&rsquo;t want to spend all the time refactoring, but definitely try a little bit to make it cleaner. To be fair, it&rsquo;s actually not that easy. On one hand you want to have well-defined helper functions instead of fuzzy ones, so you actually know what to do, and it&rsquo;s much easier to collaborate. On the other hand, you might realize there&rsquo;s a case where you want to use a function, but it does something slightly different and your function is not general enough. Personally, I sometimes try <em>too hard</em> to design my code to make it more &ldquo;aesthetic&rdquo;, like remove one edge case, pass one less parameter, keep my code extra DRY. I think at some point it becomes not worth it, especially for short-lived projects like this.</p><p>But either way, a subpar structure still helps tremendously compared to no structure / a long block of code.</p><p>This also goes back to designing. For example, you can define something simple like functions to interact with the datastore with security and integrity, and suddenly everything is easier. The dream is to have the code read like the design doc.</p><h2 id=debugging>Debugging<a hidden class=anchor aria-hidden=true href=#debugging>#</a></h2><p>Note to self: take breaks when coding. Literally wasted like 4 hours because I didn&rsquo;t call <code>json.Marshal</code> or something.</p><p>Printf debugging is good. Debugger is also pretty good.</p><h2 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h2><p>Ok this is (in my opinion) the fun part. You get to break your design.</p><p>I had this really fun idea (something similar is also suggested in the tips from the spec) to bascially:</p><ol><li>Setup the system to some state</li><li>Poke at a random byte</li><li>Run some more functions, which should either yield the correct result, or error</li></ol><p>Website TODO: add folding functionality for this chunck of code. Change tab size.</p><pre tabindex=0><code>func TestLargeModifyAttack(t *testing.T) {
	// run a bunch of client function

	m := userlib.DatastoreGetMap()
	orig := getDatastoreCopy()

	check := func(t *testing.T) {
		// run a bunch of client function and check that it either errors or is correct
		// ...
	}
	cnt := 0
	for id, bytes := range orig {
		cnt += 1
		for i, val := range bytes {
			doRun := i &lt; 400 &amp;&amp; (i%100 == 0 || i%72 == 0)
			doRun = doRun || i &lt; 2
			doRun = doRun || len(bytes)-i &lt; 2
			if doRun {
				userlib.DatastoreClear()
				applyMap(orig)
				m[id][i] = val ^ 0xff
				testStr := &#34;poking byte at &#34; + id.String() + &#34; &#34; + strconv.Itoa(i)
				t.Run(testStr, check)
			}
		}
	}

	for id := range orig {
		for id2 := range orig {
			userlib.DatastoreClear()
			applyMap(orig)
			m[id], m[id2] = m[id2], m[id]
			testStr := &#34;swapping uuid at &#34; + id.String() + &#34;____&#34; + id2.String()
			t.Run(testStr, check)
			m[id], m[id2] = m[id2], m[id]
		}
	}
}
</code></pre><p>I used the go built-in testing framework instead of Ginkgo (the framework we were supposed to use), so my partner had to write some more tests in Ginkgo. And this is actually not that easy. The problem with complicated tests is that I ended up with not so obvious bugs in my test, and I don&rsquo;t know if the bug is in my test or in my code. Would not recommend, unless you do it for fun. Not this way specifically at least, maybe something simpler that does the same thing.</p><p>Swapping caught a bunch of key reuse problems. Then I had a pretty genius idea where I changed my <code>secure_store_to_datastore</code> function and never had to worry about key reuse ever again.</p><h2 id=a-nasty-attack>A nasty attack<a hidden class=anchor aria-hidden=true href=#a-nasty-attack>#</a></h2><pre tabindex=0><code>func TestUserAttacks(t *testing.T) {
	// Incorrect password attack:
	// Replaces user in datastore with fake user, then, if user
	// forgets to enter password, they would succesfully log in
	// as the fake user.
	//
	// Fix: [redacted]

	// Generate a fake user
	t.Run(&#34;Incorrect password attack&#34;, func(t *testing.T) {
		t.Logf(&#34;Generating fake user&#34;)
		clear()
		client.InitUser(&#34;alice&#34;, &#34;&#34;)
		m := getDatastoreCopy()
		clear()

		t.Logf(&#34;Starting normal execution&#34;)
		client.InitUser(&#34;alice&#34;, &#34;realpassword&#34;)

		// replace real user with fake user
		applyMap(m)
		for key, val := range m {
			t.Logf(&#34;%s, &#34;, key)
			userlib.DatastoreSet(key, val)
		}
		_, err := client.GetUser(&#34;alice&#34;, &#34;realpassword&#34;)
		t.Logf(&#34;realpassword; error is %s&#34;, err)
		_, err = client.GetUser(&#34;alice&#34;, &#34;wrongpassword&#34;)
		t.Logf(&#34;wrongpassword; error is %s&#34;, err)
		_, err = client.GetUser(&#34;alice&#34;, &#34;&#34;)
		if err == nil {
			t.Errorf(&#34;failed fake password test&#34;)
		}
	})
}
</code></pre><p>Honestly, I don&rsquo;t even know if this is valid or tested.</p><h2 id=final-thoughts>Final thoughts<a hidden class=anchor aria-hidden=true href=#final-thoughts>#</a></h2><p>While the exact setup is not really something that would exist in the real world, it was still a nice project. I spend way more time on it than other projects.</p><p>I think an important takeaway from this project is learning to design a whole code base. Projects in other classes, like 186, gives you very good skeleton code. This is great for learning the important algorithms and great ideas without requiring too much work. But being able to build (almost) from scratch is fun and valuable too.</p><p>I love Go. It was fun to work in. Not too much crazy stuff going on, but also not annoying to work with.</p><p>I wanted to write this up a while ago, but waited half a year after the project. It ended up to be a pretty fun write. I should probably go to bed now though.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ejammy.github.io/tags/go/>Go</a></li><li><a href=https://ejammy.github.io/tags/berkeley/>Berkeley</a></li><li><a href=https://ejammy.github.io/tags/project/>Project</a></li><li><a href=https://ejammy.github.io/tags/school/>School</a></li><li><a href=https://ejammy.github.io/tags/security/>Security</a></li><li><a href=https://ejammy.github.io/tags/design/>Design</a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//ejammy.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://ejammy.github.io/>EJam's Space</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script color=175,140,240 opacity=0.2 src=https://cdnjs.cloudflare.com/ajax/libs/canvas-nest.js/2.0.4/canvas-nest.js integrity="sha512-P+NGabN/TJDOnCVOFJO+E06TBm4i+M8dTT91lWg/8UpwLrzicEXIypmABPpA47D0x6r+yxFHjYIZKWhc1h7xlQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>